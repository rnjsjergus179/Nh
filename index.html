<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>의도 기반 키 호출기</title>
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: auto; padding: 1rem; }
    textarea { width: 100%; height: 80px; margin-bottom: 0.5rem; }
    button { padding: 0.5rem 1rem; }
    pre { background: #eee; padding: 1em; white-space: pre-wrap; margin-top: 1rem; }
  </style>
</head>
<body>

  <h2>의도 기반 Render 환경변수 호출</h2>
  <p>예: <code>날씨 키 보여줘</code>, <code>구글 API 키 뭐야?</code>, <code>렌더 서비스 키</code></p>

  <textarea id="input" placeholder="의도를 입력하세요..."></textarea>
  <button id="run">키 요청</button>

  <pre id="output">// 결과가 여기에 표시됩니다</pre>

  <script>
    const RENDER_API_KEY = "rnd_MQZo2oxcvugaWw9EtJg8Ype3qxVz"; // 하드코딩된 Render 키
    const ENV_PROXY_URL = "https://your-render-app.onrender.com/api/env"; // 너의 Render API proxy 주소

    // 간단한 NLP 의도 매핑 (강화형 X, 정적 룰 기반)
    function detectIntent(text) {
      const lower = text.toLowerCase();
      if (lower.includes("날씨") || lower.includes("weather")) return "WEATHER_KEY";
      if (lower.includes("google") && lower.includes("id")) return "GOOGLE_CSE_ID";
      if (lower.includes("google") || lower.includes("api")) return "GOOGLE_API_KEY";
      if (lower.includes("render") || lower.includes("서비스")) return "RENDER_API_KEY";
      return null;
    }

    async function fetchEnvKey(varName) {
      const res = await fetch(`${ENV_PROXY_URL}?name=${encodeURIComponent(varName)}`, {
        headers: { "Authorization": `Bearer ${RENDER_API_KEY}` }
      });
      if (!res.ok) throw new Error("키 호출 실패: " + res.status);
      const json = await res.json();
      return json.value;
    }

    document.getElementById("run").addEventListener("click", async () => {
      const input = document.getElementById("input").value.trim();
      const output = document.getElementById("output");
      output.textContent = "// 처리 중...";

      const intent = detectIntent(input);
      if (!intent) {
        output.textContent = "// 알 수 없는 요청입니다. (예: 날씨 키 보여줘)";
        return;
      }

      try {
        const keyValue = await fetchEnvKey(intent);
        output.textContent = `✅ ${intent} =\n${keyValue}`;
      } catch (err) {
        output.textContent = "// 오류 발생: " + err.message;
      }
    });
  </script>

</body>
</html>
